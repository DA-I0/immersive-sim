[gd_scene load_steps=13 format=3 uid="uid://bl6wbyr3r1fx8"]

[ext_resource type="Script" uid="uid://bt2nhg1d3w01v" path="res://code/character/NPCMovement.cs" id="1_mtorf"]
[ext_resource type="Script" uid="uid://cca5de45mhgbs" path="res://code/character/NPCBase.cs" id="2_5k3kk"]
[ext_resource type="Script" uid="uid://budsljwbsqtge" path="res://code/character/CharacterSheet.cs" id="3_4j0nm"]
[ext_resource type="Script" uid="uid://cg4ngfe4q0ao0" path="res://code/character/Inventory.cs" id="4_ixmp6"]
[ext_resource type="Script" uid="uid://p2dp1frvp1va" path="res://code/character/Status.cs" id="5_sht2y"]
[ext_resource type="Script" uid="uid://e51kepvtfavs" path="res://code/character/NPCActionControler.cs" id="6_dy38d"]
[ext_resource type="Script" uid="uid://cainvdayb6aq4" path="res://code/interactables/DialogTrigger.cs" id="7_3j1xt"]
[ext_resource type="PackedScene" uid="uid://bph281bidlewd" path="res://prefabs/character_model.tscn" id="8_287o2"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_si18s"]
radius = 0.25
height = 1.8

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_fo0uy"]
transparency = 1
blend_mode = 2
albedo_color = Color(1, 0.396078, 1, 0.647059)
rim_enabled = true

[sub_resource type="BoxMesh" id="BoxMesh_yywjq"]
material = SubResource("StandardMaterial3D_fo0uy")
size = Vector3(0.1, 0.15, 0.1)

[sub_resource type="SphereShape3D" id="SphereShape3D_8u0am"]
radius = 100.0

[node name="CharacterNPC" type="CharacterBody3D"]
process_priority = 1
process_physics_priority = 1
collision_layer = 3
collision_mask = 13
axis_lock_angular_x = true
axis_lock_angular_z = true
floor_constant_speed = true
floor_max_angle = 0.872665
floor_snap_length = 0.3
safe_margin = 0.01
script = ExtResource("1_mtorf")

[node name="CharacterBase" type="Node" parent="."]
script = ExtResource("2_5k3kk")

[node name="CharacterSheet" type="Node" parent="."]
script = ExtResource("3_4j0nm")

[node name="CharacterEquipment" type="Node" parent="."]
script = ExtResource("4_ixmp6")

[node name="CharacterStatus" type="Node" parent="."]
script = ExtResource("5_sht2y")

[node name="Timer" type="Timer" parent="CharacterStatus"]

[node name="CharacterActionControler" type="Node" parent="."]
script = ExtResource("6_dy38d")
_activityType = 1

[node name="Timer" type="Timer" parent="CharacterActionControler"]
autostart = true

[node name="CharacterDialog" type="Node" parent="."]
script = ExtResource("7_3j1xt")
_startingDialogNode = "test_dialog_1-1"

[node name="Collider" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.9, 0)
shape = SubResource("CapsuleShape3D_si18s")

[node name="Marker3D" type="Marker3D" parent="Collider"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 5.96046e-08, 0.1719, 0.294861)

[node name="CharacterModel" parent="." instance=ExtResource("8_287o2")]
transform = Transform3D(-1, 0, -1.50996e-07, 0, 1, 0, 1.50996e-07, 0, -1, 0, 0, 0)

[node name="Skeleton3D" parent="CharacterModel/root" index="0"]
bones/0/position = Vector3(-0.00730737, 0.965737, 0.254517)
bones/0/rotation = Quaternion(0.130706, 0.14469, -0.0101098, 0.980754)
bones/1/position = Vector3(0.101935, -0.026015, 0.00481078)
bones/1/rotation = Quaternion(0.752635, 0.0998243, 0.650595, 0.0173606)
bones/1/scale = Vector3(0.999998, 1.02734, 1)
bones/2/rotation = Quaternion(-3.89479e-05, 5.4367e-05, 0.00256851, 0.999997)
bones/2/scale = Vector3(1, 1, 1)
bones/3/position = Vector3(6.05415e-05, 0.427941, 3.33451e-05)
bones/3/rotation = Quaternion(0.281303, 0.532042, -0.31225, 0.735051)
bones/3/scale = Vector3(0.999291, 0.989071, 0.985691)
bones/4/position = Vector3(0.00172384, 0.12762, -0.00308564)
bones/4/rotation = Quaternion(0.104367, 0.943013, 0.314921, -0.0256766)
bones/4/scale = Vector3(1.00017, 0.987257, 1.01241)
bones/5/position = Vector3(-0.1019, -0.0260434, 0.0048768)
bones/5/rotation = Quaternion(-0.99406, 0.0385972, 0.0135948, -0.100844)
bones/5/scale = Vector3(0.999997, 1.00928, 0.999999)
bones/6/position = Vector3(1.569e-06, 0.389355, 3.08166e-07)
bones/6/rotation = Quaternion(-3.23676e-06, -2.12008e-05, -0.00260432, 0.999997)
bones/6/scale = Vector3(1, 1, 1)
bones/7/position = Vector3(-1.75745e-05, 0.427941, 3.09516e-06)
bones/7/rotation = Quaternion(0.126684, -0.842714, 0.367498, 0.372465)
bones/7/scale = Vector3(0.999925, 0.995526, 0.995283)
bones/8/position = Vector3(-0.00102785, 0.12766, -0.0010324)
bones/8/rotation = Quaternion(-0.0586924, 0.946225, 0.318029, 0.00847418)
bones/8/scale = Vector3(1.00002, 0.995512, 1.00446)
bones/9/rotation = Quaternion(-0.121236, -0.147591, 0.0121751, 0.981514)
bones/10/rotation = Quaternion(-0.0754051, 0.00329202, 0.000248944, 0.997148)
bones/11/rotation = Quaternion(0.313699, 0.00638646, 0.0021101, 0.949499)
bones/12/rotation = Quaternion(-0.16408, -0.00666737, -0.00110132, 0.986424)
bones/13/rotation = Quaternion(-0.46513, 0.611495, -0.505795, -0.392299)
bones/14/rotation = Quaternion(0.424803, 0.523317, 0.366211, 0.641539)
bones/15/rotation = Quaternion(0.298419, 0.122596, 0.23946, 0.915738)
bones/15/scale = Vector3(1, 0.999753, 1)
bones/16/rotation = Quaternion(0.0421663, 0.282599, -0.00166753, 0.95831)
bones/16/scale = Vector3(0.999999, 1.00024, 1)
bones/17/position = Vector3(-0.0491646, 0.0500859, -0.00461863)
bones/17/rotation = Quaternion(0.0464701, -0.786923, 0.317009, 0.52735)
bones/17/scale = Vector3(1.00001, 0.999984, 1)
bones/18/position = Vector3(1.61455e-07, 0.0210912, 8.59147e-07)
bones/18/rotation = Quaternion(-0.0242228, -0.306659, 0.0625978, 0.94945)
bones/18/scale = Vector3(0.99999, 0.999995, 1.00002)
bones/19/position = Vector3(2.44412e-07, 0.0270387, 2.15977e-07)
bones/19/rotation = Quaternion(-0.00920788, 0.438728, 0.00859628, 0.898531)
bones/19/scale = Vector3(1.00001, 1, 0.99999)
bones/20/position = Vector3(0.0245621, 0.0860408, -0.00147585)
bones/20/rotation = Quaternion(-0.713076, 0.123748, -0.0284451, 0.689493)
bones/20/scale = Vector3(1, 1, 0.999994)
bones/21/position = Vector3(1.57686e-05, 0.0220773, 2.96639e-06)
bones/21/rotation = Quaternion(-0.585523, -0.0206093, 0.00936709, 0.810339)
bones/21/scale = Vector3(1, 1.00002, 0.999983)
bones/22/position = Vector3(-1.57512e-06, 0.0315886, 1.6207e-06)
bones/22/rotation = Quaternion(-0.587469, -0.00381375, -0.00984868, 0.809178)
bones/22/scale = Vector3(0.999999, 0.999987, 1.00001)
bones/23/position = Vector3(-0.00260175, 0.0868647, 0.00038206)
bones/23/rotation = Quaternion(-0.450182, 0.161463, -0.0363564, 0.877464)
bones/23/scale = Vector3(1, 0.999975, 1.00002)
bones/24/position = Vector3(-3.16799e-06, 0.0279776, -1.50861e-06)
bones/24/rotation = Quaternion(-0.64571, -0.00769497, -0.0194433, 0.763297)
bones/24/scale = Vector3(0.999998, 1, 0.999997)
bones/25/position = Vector3(3.84009e-07, 0.0270531, 9.9002e-07)
bones/25/rotation = Quaternion(-0.639766, -0.0177411, -0.0200563, 0.768103)
bones/25/scale = Vector3(0.999999, 0.999999, 1)
bones/26/position = Vector3(-0.0322425, 0.083422, -0.0018827)
bones/26/rotation = Quaternion(-0.425603, 0.144516, -0.0385396, 0.892464)
bones/26/scale = Vector3(1, 0.999974, 1.00002)
bones/27/position = Vector3(-2.69881e-06, 0.0306824, -8.66344e-07)
bones/27/rotation = Quaternion(-0.583527, 0.00193095, -0.0536865, 0.810315)
bones/27/scale = Vector3(1, 1.00001, 0.999995)
bones/28/position = Vector3(2.22879e-06, 0.0307386, 9.98231e-07)
bones/28/rotation = Quaternion(-0.59928, 0.00781383, -0.029632, 0.799953)
bones/28/scale = Vector3(0.999998, 1, 0.999995)
bones/29/rotation = Quaternion(0.465923, 0.610988, -0.506352, 0.391429)
bones/30/rotation = Quaternion(-0.424821, 0.523341, 0.366081, -0.641581)
bones/31/rotation = Quaternion(0.298407, -0.12263, -0.23955, 0.915713)
bones/31/scale = Vector3(1, 0.999932, 1)
bones/32/rotation = Quaternion(0.0422011, -0.282431, 0.00202871, 0.958357)
bones/32/scale = Vector3(0.999999, 1.00007, 1)
bones/33/rotation = Quaternion(0.0467031, 0.787035, -0.316929, 0.52721)
bones/33/scale = Vector3(1, 0.999996, 1)
bones/34/rotation = Quaternion(-0.0241585, 0.306849, -0.0624171, 0.949402)
bones/35/rotation = Quaternion(-0.00919869, -0.43853, -0.00836447, 0.89863)
bones/35/scale = Vector3(1, 0.999999, 0.999997)
bones/36/position = Vector3(-0.0246052, 0.0860427, -0.00150682)
bones/36/rotation = Quaternion(-0.713035, -0.123602, 0.0292087, 0.68953)
bones/36/scale = Vector3(1, 1, 0.999998)
bones/37/rotation = Quaternion(-0.585551, 0.0207869, -0.00922038, 0.810316)
bones/38/rotation = Quaternion(-0.587466, 0.00385781, 0.0101542, 0.809176)
bones/38/scale = Vector3(1, 0.999996, 1)
bones/39/position = Vector3(0.00255965, 0.0868697, 0.000348659)
bones/39/rotation = Quaternion(-0.450104, -0.161248, 0.0368453, 0.877524)
bones/39/scale = Vector3(1, 0.999993, 1.00001)
bones/40/rotation = Quaternion(-0.645696, 0.00768164, 0.0197525, 0.763301)
bones/40/scale = Vector3(1, 1, 0.999998)
bones/41/rotation = Quaternion(-0.639762, 0.0177705, 0.0203457, 0.768098)
bones/42/position = Vector3(0.0322043, 0.0834298, -0.00191826)
bones/42/rotation = Quaternion(-0.425481, -0.144288, 0.0390203, 0.892538)
bones/42/scale = Vector3(1, 0.999993, 1.00001)
bones/43/rotation = Quaternion(-0.583503, -0.00190839, 0.0540069, 0.810311)
bones/43/scale = Vector3(1, 1, 0.999998)
bones/44/rotation = Quaternion(-0.599265, -0.00776474, 0.0298958, 0.799954)

[node name="AnimationTree" parent="CharacterModel" index="2"]
advance_expression_base_node = NodePath("../..")

[node name="Camera" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.7, -0.15)
cull_mask = 1048571
doppler_tracking = 2

[node name="Label" type="Label" parent="Camera"]
offset_right = 40.0
offset_bottom = 23.0
size_flags_horizontal = 2
size_flags_vertical = 2

[node name="ItemHoldPosition" type="Node3D" parent="Camera"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.4, -0.6)

[node name="MeshInstance3D" type="MeshInstance3D" parent="Camera/ItemHoldPosition"]
visible = false
mesh = SubResource("BoxMesh_yywjq")

[node name="ItemPlaceTarget" type="Marker3D" parent="Camera"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -1.5)

[node name="NavigationAgent3D" type="NavigationAgent3D" parent="."]
path_desired_distance = 0.5
target_desired_distance = 0.1
path_height_offset = 0.5
avoidance_enabled = true
radius = 0.6
neighbor_distance = 10.0
max_speed = 1.5
debug_enabled = true
debug_path_custom_color = Color(1, 0, 1, 1)

[node name="InteractableScanner" type="Area3D" parent="."]
collision_layer = 0
collision_mask = 16
monitorable = false

[node name="CollisionShape3D" type="CollisionShape3D" parent="InteractableScanner"]
shape = SubResource("SphereShape3D_8u0am")

[connection signal="timeout" from="CharacterStatus/Timer" to="CharacterStatus" method="RegenStamina"]
[connection signal="timeout" from="CharacterActionControler/Timer" to="CharacterActionControler" method="SelectNewActivity"]
[connection signal="navigation_finished" from="NavigationAgent3D" to="." method="TargetDestinationReached"]
[connection signal="area_entered" from="InteractableScanner" to="CharacterActionControler" method="AddUsableToList"]
[connection signal="area_exited" from="InteractableScanner" to="CharacterActionControler" method="RemoveUsableFromList"]

[editable path="CharacterModel"]
